#include "SampleFilter.h"

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
  -0.0001936701176317387,
  -0.00008112657260770766,
  -0.00009400146404701015,
  -0.00010477115097734193,
  -0.0001121503792715322,
  -0.00011482299996046386,
  -0.00011067235264097016,
  -0.00009851675914232661,
  -0.00007543636900238263,
  -0.000039412640938014076,
  0.000011923138132111343,
  0.00008155373090437469,
  0.00017236613126262346,
  0.00028747675945051273,
  0.0004297638322805549,
  0.0006024831415956184,
  0.0008089399482788553,
  0.0010522269529305373,
  0.0013354587668435833,
  0.0016614976291327182,
  0.002033093262555854,
  0.0024526693330501055,
  0.002922381976700111,
  0.003444118328880997,
  0.004019201342866058,
  0.004648499440906678,
  0.00533233204392071,
  0.0060705027851247866,
  0.006862221638730539,
  0.007706009443092775,
  0.008599800023230672,
  0.009540802657313907,
  0.010525553679974032,
  0.011549928533565477,
  0.012609147599874637,
  0.013697829103075432,
  0.014809939264975308,
  0.015938943816908167,
  0.017077834065118005,
  0.018219165593768693,
  0.019355153100210715,
  0.020477709636161207,
  0.02157859096929754,
  0.022649432471521062,
  0.02368188350834536,
  0.024667728879402002,
  0.025598928517719263,
  0.026467751426225258,
  0.027266843266534817,
  0.02798936472874905,
  0.028629058356398434,
  0.02918029948045822,
  0.02963822022024767,
  0.029998725552980124,
  0.030258577451912586,
  0.030415429935633693,
  0.03046786570115365,
  0.030415429935633693,
  0.030258577451912586,
  0.029998725552980124,
  0.02963822022024767,
  0.02918029948045822,
  0.028629058356398434,
  0.02798936472874905,
  0.027266843266534817,
  0.026467751426225258,
  0.025598928517719263,
  0.024667728879402002,
  0.02368188350834536,
  0.022649432471521062,
  0.02157859096929754,
  0.020477709636161207,
  0.019355153100210715,
  0.018219165593768693,
  0.017077834065118005,
  0.015938943816908167,
  0.014809939264975308,
  0.013697829103075432,
  0.012609147599874637,
  0.011549928533565477,
  0.010525553679974032,
  0.009540802657313907,
  0.008599800023230672,
  0.007706009443092775,
  0.006862221638730539,
  0.0060705027851247866,
  0.00533233204392071,
  0.004648499440906678,
  0.004019201342866058,
  0.003444118328880997,
  0.002922381976700111,
  0.0024526693330501055,
  0.002033093262555854,
  0.0016614976291327182,
  0.0013354587668435833,
  0.0010522269529305373,
  0.0008089399482788553,
  0.0006024831415956184,
  0.0004297638322805549,
  0.00028747675945051273,
  0.00017236613126262346,
  0.00008155373090437469,
  0.000011923138132111343,
  -0.000039412640938014076,
  -0.00007543636900238263,
  -0.00009851675914232661,
  -0.00011067235264097016,
  -0.00011482299996046386,
  -0.0001121503792715322,
  -0.00010477115097734193,
  -0.00009400146404701015,
  -0.00008112657260770766,
  -0.0001936701176317387
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
